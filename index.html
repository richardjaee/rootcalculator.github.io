<!DOCTYPE HTML>
<html lang = "en">
  <head>
    <title>fixedpoint.html</title>
    <meta charset = "UTF-8" />
    <script src="https://unpkg.com/mathjs@9.2.0/lib/browser/math.js"></script>
  </head>
  <body>
    <h1>Bisection Method</h1>
    <form id="FPM">
        <label for="lower">Lower Bound:</label><br>
        <input type="text" id="lower" name="lower"><br>
        <label for="upper">Upper Bound:</label><br>
        <input type="text" id="upper" name="upper"><br>
        <label for="tol">Tolerance:</label><br>
        <input type="text" id="tol" name="tol"><br>
        <label for="fx">Function:</label><br>
        <input type="text" id="fx" name="fx"><br>
        <label for="iter">Max Iterations:</label><br>
        <input type="text" id="iter" name="iter"><br><br>
      </form>
      <button onclick="myFunction()">Submit</button>
      <p id="calculation"></p>

<!-- JavaScript for the calculations -->
<script type="text/javascript">
  
    function myFunction() {

        const parser = math.parser()

        var x = document.getElementById("FPM");
        

        let lower = Number(x.elements[0].value).toFixed(5);
        let upper = Number(x.elements[1].value).toFixed(5);
        let tol = x.elements[2].value;
        let fx = x.elements[3].value;

        let iter = x.elements[4].value;
        
        text = "";

        // Checks 
        fa = fxCalc(fx, lower);
        fb = fxCalc(fx, upper);

        if (fa*fb>0)
        {
          text+= "f(a) and f(b) have the same signs " + "<br>";
          document.getElementById("calculation").innerHTML = text;
          return;
        }
        //

      


        if (tol === "") { tol = 0.00001; }
        if (iter === "") { iter = 21; }

        let p = 0;

        for (var i = 1; i < iter; i++){
          
          p = ((parseFloat(lower)+parseFloat(upper))/(2)).toFixed(5);
          text += "P " + i + " = " + p + "<br>";

          fp = fxCalc(fx, p);
          fa = fxCalc(fx, lower);

          let condition2 = ((parseFloat(upper)-parseFloat(lower))/(2)).toFixed(5);

          if (fp === 0 || condition2 < tol)
          { 
            text+= "Finished in " + i + " iteration(s)" + "<br>";
            document.getElementById("calculation").innerHTML = text;
            break;
          }

          else if ( fa*fp > 0)
          {
            lower = p;
            fa = fp;
          }

          else { upper = p; }
        } 

        document.getElementById("calculation").innerHTML = text;  
    } 
    
    //calculates f(x)
    function fxCalc(fx, a){ 
      let scope = {
        x: a
      }
      //const node = math.parse(fx)         // parse expression into a node tree
      //const code = node.compile()           // compile the node tree

      //const code = math.compile(fx);
      //const result = code.evaluate(scope);

      const result = math.evaluate(fx, scope)


      return result
    }
  
    
    </script>
</body>
</html>
